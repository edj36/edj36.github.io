<!-- <html> -->
<head>
<!-- Load the d3 library. -->
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="../style/normalize.css">
<link rel="stylesheet" type="text/css" href="../style/main.css">
<link rel="stylesheet" type="text/css" href="../style/style.css">
<!--<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"> -->
<link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80419417-1', 'auto');
  ga('send', 'pageview');

</script>
</head>

<!--<title>OCaml</title> -->

<meta charset="utf-8">
<xmp theme="journal">
  ## OCaml Client/Server

  Recently in a project for school, my team and I decided to build a server to
  complement a game we had been working on . The [course][3110] is about functional programming and
  is taught in OCaml, thus we needed to use Ocaml to implement the client and server we wanted for our game.
  I certainly struggled at first finding useful examples or documentation for my needs, so here I am going to
  try and make my own.

  ## Setup
  * * *

  First, install Ocaml. [Here][install]
  is how I did it.

  Next, we need to install a couple of libraries, specifically `cohttp` and `lwt`.
  Those are the libaries we are going to use for networking (`cohttp`) and for
  threading (`lwt`). Get them from `opam` like this:
  ```
  $ opam install cohttp lwt
  ```
  `cohttp` is a popular OCaml HTTP library, and `lwt` (Light Weight
  Threading) is exactly that, a light-weight thread library for Ocaml.

  ## Client
  * * *

  For my purposes, I need my client to be able to send `GET` and `POST` requests. This a bit
  tricky at first, but usually pretty simple once you have a general form for your requests.

  You can dig through the [cohttp][co-http] repository to find their implementation of different requests,
  and to learn what you need to supply to send the requests. The repo also has a few useful
  examples, which I built upon for my purposes.

  First, the `GET` request:
  ``` ocaml
  let get_request =
    Client.get (Uri.of_string "http://127.0.0.1:8080/") >>= fun (resp, body) ->
    let code = resp |> Response.status |> Code.code_of_status in
    Printf.printf "Response code: %d\n" code;
    body |> Cohttp_lwt_body.to_string >|= fun body ->
    Printf.printf "Body of length: %d\n" (String.length body);
    body
  ```

  `POST` request:
  ``` ocaml
  let post_request = failwith "unimplemented"
  ```
  Now to send either request:
  ``` ocaml
  (* sends GET request *)
  Lwt.run get_request
  (* sends POST request *)
  Lwt.run post_request
  ```

  ## Server
  * * *
  More to come

  [co-http]: http://github.com/mirage/ocaml-cohttp/
  [install]: http://www.cs.cornell.edu/courses/cs3110/2016fa/install.html
  [3110]: http://www.cs.cornell.edu/courses/cs3110/2016fa/index.php


  ## Usage
  Now that we have the client and server implemented, lets develop a way to use them.
  I made a Makefile so that I would be able to run simple commands like
  `make server` in my terminal to compile and run the code.
  Makefile is as follows:
  ```
  client:
  ocamlbuild -pkg cohttp.lwt client_example.native && ./client_example.native

  server:
  ocamlbuild -pkg cohttp.lwt server_example.native && ./server_example.native

  clean:
  ocamlbuild -clean
  ```

  </xmp>

  <script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>

<!--/html>-->
